---
sidebar_position: 7
---

# 7. 캐시

캐시는 다음의 특징을 가집니다.

- 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 비용을 줄여줍니다.
- 캐시는 네트워크 병목을 줄여줍니다. 대역폭을 늘리지 않고도 페이지를 빨리 불러올 수 있게 됩니다.
- 캐시는 원 서버에 대한 요청을 줄여줍니다. 서버는 부하를 줄일 수 있으며 더 빨리 응답할 수 있게 됩니다.
- 페이지를 먼 곳에서 불러올수록 시간이 많이 걸리는데, 캐시는 거리로 인한 지연을 줄여줍니다.

## 7.1 불필요한 데이터 전송

- 서버에서 똑같은 바이트를 네트워크를 통해서 반복해서 이동하는 경우는 네트워크의 대역폭을 잡아먹고, 전송을 니르고, 웹 서버에 부하를 줍니다.
- 캐시를 이용하면 첫번째 서버 응답은 캐시에 보관됩니다. 이러한 사본이 요청에 대한 응답으로 사용될 수 있기 때문에 원 서버가 중복해서 트래픽을 주고받는 낭비가 줄어듭니다.

<br/>

## 7.2 대역폭 병목

- 캐시는 네트워크 병목을 줄여줍니다.
- 클라이언트들이 서버에 접근할 때의 속도는 그 경로에 있는 가장 느린 네트워크 속도와 같습니다. 이때 빠른 LAN에 있는 캐시에서 사보능ㄹ 가져오면 성능을 높일 수 있습니다.

<br/>

## 7.3 갑작스런 요청 쇄도(Flash Crowds)

- 캐싱은 갑작스런 요청 쇄도에 대처하기위해 중요합니다.

<br/>

## 7.4 거리로 인한 지연

- 대역폭이 문제가 되지않더라도 거리가 문제가 될 수 있습니다.
- 모든 네트워크 라우터는 제 각각 인터넷 트래픽을 지연시킵니다.
- 클라이언트와 서버 사이에 라우터가 그다지 많지 않아도, 빛의 속도 그자체가 유의미한 지연을 만듭니다.
- 캐시를 통해서 이러한 지연을 줄일 수 있습니다.

<br/>

## 7.5 적중과 부적중

- 캐시가 세상 모든 문서의 사본을 저장하지는 않습니다.
- 캐시가 적중되는 경우에서는 캐시 적중(cache hit)라고 하며 대응하는 사본이 없는 경우, 원서버로 전달하고 이를 캐시 부적중(cache miss)라고 합니다.

### 재검사(Revalidation)

- 원 서버 콘텐츠는 변경될 수 있기 때문에, 캐시는 반드시 사본이 최신인지를 검사해야합니다. 이를 **신선도 검사**라고 합니다.
- 캐시는 스스로 원한다면 언제든 사보능ㄹ 재검수할 수 있습니다.
- 캐시는 캐시된 사본의 재검사가 필요할 때, 원 서버에 작은 재검사 요청을 보내며 변경되지 않았다면 서버는 `304 Not Modified` 응답을 보냅니다.

다음의 경우 `If-Modified-Since` 헤더를 보내며, 이는 서버에게 캐시가 변경된 이후 사본을 보내달라는 요청입니다.

- 서버 콘텐츠가 변경되지 않은 경우 : 재검사 적중
- 서버 콘텐츠가 변경된 경우 : 재검수 부적중, 다시 보냅니다. (`200 OK`)
- 객체가 삭제된 경우 : 객체 삭제, 사본을 삭제합니다. (`404 Not Found`)

### 적중률

- 캐시가 요청을 처리하는 비율을 캐시 적중률이라고 합니다. (100%는 모든 요청이 캐시 적중임을 의미합니다.)
- 캐시 관리자는 캐시 적중률이 100%에 근접되는 것이 좋으나 현실은 40%라도 좋습니다.

### 바이트 적중률

- 문서들이 모두 같은 크기인 것은 아니기 때문에 캐시 적중률이 모든 것을 말해주는 것은 아닙니다.
- 바이트 단위 적중률은 캐시를 통해 제공된 모든 바이트의 비율을 표현합니다. (100%는 모든 바이트가 캐시에서 왔으며 어떤 트래픽도 인터넷으로 나가지 않음을 의미합니다.)
- 문서적중률과 바이트 단위 적중률은 모두 중요합니다.

### 적중과 부적중의 구별

- HTTP는 클라이언트에게 응답이 캐시 적중이었는지, 우너 서버 접근인지 말해줄 수 있는 방법을 제공하지 않습니다.
- 클라이언트가 응답이 캐시에서 왔는지 알아내는 방법 중 하나는 Date 헤더를 이용하는 것입니다.
- 또 다른 방법 중 하나는 응답이 얼마나 오래되었는지 확인하는 Age헤더를 사용하는 것입니다.

<br/>

## 7.6 캐시 토폴로지

- 개인 전용 캐시 : 한명에게 할당된 캐시
- 공용 캐시 : 사용자 집단에게 자주 쓰이는 페이지

### 개인 전용 캐시

- 많은 저장 공간이 필요없으므로 작고 저렴합니다.
- 익스플로러는 캐시된 문서를 임시 파일이라 불립니다.

### 공용 프락시 캐시

- 프락시 캐시는 로컬 캐시에서 문서를 제공하거나, 혹은 사용자의 입장에서 서버에 접근합니다.
- 공용 캐시에는 여러 사용자가 접근하기 때문에 불필요한 트래픽을 줄일 수 있습니다.
- 각 개인 전용 캐시는 네트워크를 거쳐 여러번 가져옵니다.

### 프락시 캐시 계층들

- 클라이언트 주위에는 작고 저렴한 캐시를 사용하고 계층 상단에는 많은 사용자들에 의해 공유되는 문서를 유지합니다.
- 다만, 프락시 연쇄가 깊어질수록 각 중간 프락시는 현저한 성능 저하가 발생합니다.

### 캐시망, 콘텐츠 라우팅, 피어링

캐시망 안에서 콘텐츠 라우팅을 위하 설계된 캐시들은 다음의 일을 할 수 있습니다.

- URL에 근거하여 부모 캐시와 원 서버 중 하나를 동적으로 선택합니다.
- URL에 근거하여 특정 부모 캐시를 동적으로 선택합니다.
- 부모 캐시에게 가기 전에 캐시된 사본을 로컬에서 선택합니다.
- 다른 캐시들이 그들의 캐시된 콘텐츠에 부분적으로 접근할 수 있도록 허용하되, 그들의 캐시를 통한 Internet transit은 허용되지 않습니다.

<br/>

## 7.7 캐시 처리단계

<br/>

## 7.8 사본을 신선하게 유지하기

<br/>

## 7.9 캐시 제어

<br/>

## 7.10 캐시 제어 설정

<br/>

## 7.11 자세한 알고리즘

<br/>

## 7.12 캐시와 광고
