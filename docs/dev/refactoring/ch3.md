# 코드에서 나는 악취

리팩터링을 작동 방법을 알았다면 적용 시점에 대해서도 알아야합니다.

<br/>

## 기이한 이름

코드는 단순하고 명료하게 작성하는 것이 중요합니다. 그 중 하나가 바로 **이름**입니다.

- 함수 선언 바꾸기
- 변수 이름 바꾸기
- 필드 이름 바꾸기

이름이 명확하지 않다면 설계에 근본적인 문제가 있을 확률이 높고, 혼란스러운 이름을 잘 정리하다 보면 코드가 훨씬 간결해질 때가 많습니다.

## 중복 코드

똑같은 코드 구조가 여러 곳에서 반복되면 하나로 통합해서 더 나은 방법으로 만들어야 합니다.

- 함수 추출하기
  - 한 클래스에 딸린 두 메서드가 똑같은 표현식을 사용하는 경우
- 문장 슬라이드하기
  - 비슷한 부분을 한 곳에 모아 함수 추출할 때 사용
- 메서드 올리기
  - 같은 부모 클래스로 파생된 자식 클래스에 코드 중복이 있는 경우, 각자 호출이 되지 않도록 적용합니다.

<br/>

## 긴 함수

함수를 짧게 구성하면 다음의 장점을 가집니다.

- 관리하기 편리해 집니다.
- 간접 호출의 효과를 볼 수 있습니다.
- 코드를 이해하고 공유하기 쉽습니다.
- 선택하기 쉬워집니다.

또한 예전과 달리 프로세스 안에서 함수 호출 비용이 거의 없습니다.

다음의 과정으로 할 수 있습니다

- 함수 추출하기
  - 함수를 짧게 만드는 작업의 99%를 차지합니다.
  - 함수 본문에서 따로 묶어서 빼내면 좋은 코드 덩아리를 새로운 함수로 만듭니다.
- 임시변수를 질의 함수로 변경, 매개변수 객체 만들기, 객체를 통째로 넘기기
  - 매개 변수가 너무 많아지면 난해해지기 때문에 사용합니다.
- 함수를 명령으로 바꾸기
  - 임시 변수와 매개 변수가 너무 많은 경우, 추가적으로 사용할 수 있습니다.
- 조건문을 분해하기
  - 거대한 switch 문을 구성하는 case 문마다 **함수를 추출**하고, 함수 하나로 변경합니다.
- 조건문을 다형성으로 바꾸기
  - switch문을 여러개 하는 것도 좋습니다.
- 반복문 쪼개기
  - 반복문도 안의 코드를 추출해서 독립된 함수로 만들어서 적합한 이름과 성격을 가지게 합니다.

<br/>

## 긴 매개변수 목록

매개변수 목록이 길어지면 이해하기 어려워집니다.

- 매개변수를 질의 함수로 바꾸기
  - 매개변수에서 값을 얻어올 수 있는 매개변수를 얻을 수 있음.
- 객체 통째로 넘기기
  - 사용 중인 데이터 구조에서 값들을 뽑아 각각의 별개의 매개변수로 전달합니다.
- 매개변수 객체 만들기
  - 원본 객체를 그대로 넘겨서 짧게 합니다.
- 플래그 인수 제거하기
  - 함수의 동작 방식을 정하는 플래그 역할의 매개변수를 지웁니다.
- 여러 함수를 클래스로 묶기
  - 여러개의 함수가 특정 매개변수들의 값을 공통으로 사용할 때 유용합니다.

<br/>

## 전역 데이터

전역데이터는 어디에서든 건드릴 수 있고, 값을 누가 바꿨는지 찾아낼 매커니즘이 없기 때문에 문제가 됩니다.

- 변수 캡슐화하기
  - 다른 코드에서 오염시킬 가능성이 있는 데이터를 발견할 때마다 진행합니다.
  - 데이터를 함수로 감싸서 수정하는 부분을 쉽게 찾고 접근을 통제합니다
  - 더 나아가 함수들을 클래스나 모듈에 집어넣고 안에서만 수정이 되도록 하고, 접근 범위를 최소화합니다.

전역 데이터를 캡슐화해야지, 변화에 대처할 수 있습니다.

<br/>

## 가변 데이터

데이터를 변경했더니 예상치 못한 결과나 골치 아픈 버그가 발생하는 문제가 있습니다. 특히 이러한 문제는 원인을 발생하기 어려울 때가 있습니다.

이를 해결하기 위해서 함수형 프로그래밍에서의 데이터는 절대 변하지 않고, 데이터를 변경하려면 반드시 변경하려는 값에 해당하느 복사본을 만들어서 반환한다는 개념을 가지고 있습니다. 다만 함수형 언어가 프로그래밍에서 차지하는 비중은 적고, 변수 값을 바꿀 수 있는 언어를 사용하는 프로그래머가 더 많습니다.

하지만 불변성이 주는 장점을 포기할 필요는 없습니다.

- 변수 캡슐화하기
  - 정해놓은 함수를 지정해, 수정하도록 하면 값이 어떻게 바뀌는지 알거나 코드를 개선하기 쉽습니다.
- 변수 쪼개기
  - 변수에 용도가 다른 값들을 저장해 값을 갱신하는 경우
  - 용도별로 독립 변수에 저장하여 값 갱신이 문제를 일으키는 부분을 없앱니다.
- 문장 슬라이드하기, 함수 추출하기
  - 갱신 코드를 분리하여 부작용을 줄입니다.
- 질의 함수와 변경 함수 분리하기
  - API를 만들때 진행합니다.
  - 부작용이 있는 코드를 호출할 수 없게합니다.
- 세터 제거하기
  - 세터를 호출하는 곳을 제한하면 변수의 유효 범위를 줄일 수 있습니다.
- 파생 변수를 질의함수로 바꾸기
  - 값을 여러곳에서 설정할 수 있는 경우는 여러 혼동과 버그를 만들 수 있습니다.
- 여러 함수를 클래스로 묶기, 여러 함수를 변환 함수로 묶기
  - 변수의 유효 범위가 넓어지면 위험이 커집니다.
  - 변수를 갱신하는 코드들의 유효범위를 클래스나 변환으로 제한합니다.
- 참조를 값으로 바꾸기
  - 구조체처럼 내부 필드에 데이터를 담고 있는 변수의 경우 적용합니다.
  - 때로는 내부 필드를 수정하는 것 보다는 구조체를 통째로 교체하는 편이 좋습니다.

<br/>

## 뒤엉킨 변경

일반적으로 뒤엉킨 변경은 단일 책임 원칙(SRP, Single Responsibility Principle)이 제대로 지켜지지 않을 때 발생합니다.

- 단계 쪼개기
  - 반약에 순차적으로 실행되는 게 자연스러운 경우
  - 맥락에 필요한 데이터를 특정한 데이터 구조에 담아 전달하게 하는 식으로 단계를 분리합니다.
- 함수 옮기기
  - 전체 처리 과정 곳곳에서 각기 다른 맥락의 함수를 호출하는 빈도가 높은 경우
  - 각 맥락에 해당하는 적당한 모듈들을 만들어 관련 함수를 모읍니다.
- 함수 추출하기, 클래스 추출하기
  - 맥락의 일에 관련하는 함수나 클래스인 경우, 진행합니다.

<br/>

## 산탄총 수술

뒤엉킨 변경과 비슷하면서 정반대입니다. 일반적으로 코드를 변경할 때마다 자잘하게 수정해야 하는 클래스가 많을 때 풍깁니다.

- 함수 옮기기, 필드 옮기기
  - 한 모듈에 묶어서 처리합니다.
- 여러 함수를 클래스로 묶기
  - 비슷한 데이터를 다루는 함수가 많은 경우
- 여러 함수를 변환 함수로 묶기
  - 데이터 구조를 변환하거나 보강하는 함수들이 많은 경우
- 단계 쪼개기
  - 묵은 함수들의 출력 결를 묶어서 다음 단계의 로직으로 전달합니다.
- 함수 인라인하기, 클래스 인라인 하기
  - 어설프게 분리된 로직을 모으기
  - 메서드나 클래스가 커지면 추출하기를 통해서 분리할 수도 있습니다.

<br/>

## 기능 편애

프로그램을 모듈화할 때는 코드를 여러 영역으로 나눈 뒤, **영역 안에서 이뤄지는 상호작용은 최대한 늘리고 영역 사이에서 이뤄지는 상호작용을 최소로 줄입니다.**

- 함수 옮기기, 함수 추출하기
  - 데이터와 함수가 가까이 있어야한다고 판단되면 이를 모아줍니다.
  - 일부 함수에서만 그 기능이 필요하다고 판단하면, 독립함수로 빼서 원하는 모듈로 보내줍니다.
  - 옮길 곳이 명확하지 않는 경우, 가장 많은 데이터를 포함한 모듈로 이동합니다.

이를 해결하는 다양한 패턴들이 존재합니다.

- 전략 패턴, 방문자 패턴, 자기 위임
  - **이러한 패턴의 핵심은 함께 변경할 대상을 한 곳에 모으는 것**입니다.

<br/>

## 데이터 뭉치

<br/>

## 기본형 집착

<br/>

## 반복되는 switch 문

<br/>

## 반복문

<br/>

## 성의 없는 요소

<br/>

## 추측성 일반화

<br/>

## 임시 필드

<br/>

## 메시지 체인

<br/>

## 중개자

<br/>

## 내부자 거래

<br/>

## 거대한 클래스

<br/>

## 서로 다른 인터페이스의 대안 클래스들

<br/>

## 데이터 클래스

<br/>

## 주석
