---
sidebar_position: 9
---

# 9. 일관성과 합의

- 8장에서 봤듯이 분산 시스템에서는 많은 것들이 잘못될 수 있습니다. 쉬운 해결책으로 전체 서비스가 실패하도록 두고 사용자에게 오류 메시지를 보여주는 것이빈다.
- 이러한 해결책이 어렵다면 결함을 **견더낼(tolerating)** , 방법을 찾아야합니다.
- 아래에서는 내결함설을 지닌 분산 시스템을 구축하는 데 쓰이는 알고리즘과 프로토콜의 몇 가지 예를 이야기합니다.

## 일관성 보장

- 복제 데이터 베이스는 대부분 최소한 **최종적 일관성**을 제공합니다.
  - 데이터베이스에 쓰기를 멈추고 볼 특정 시간 동안 기다리면 결국 모든 읽기 요청이 같은 값을 반환한다는 뜻이빈다.
  - 모든 복제본이 결국 같은 값으로 **수렴**되기를 기대함으로 최종적 일관성보다 수렴이 더 나은 이름일 수도 있습니다.
- 다만 위는 매우 약한 보장이며, 언제 복제본이 수렴될지에 대해서는 이야기가 없습니다.
- 약한 보장만 제공하는 데이터베이스를 다룰 때는 그 제한을 알아야하고 뜻하지 않게 너무 많은 것을 가정하면 안됩니다.

아래에서는 데이터 시스템이 선택적으로 제공할 수 있는 더욱 강한 일관성 모델을 살펴봅니다.

- 공통적으로 사용되는 가장 강한 일관성 모델 중 하나인 선현성(linearizability)을 살펴보고 장점과 단점을 검토합니다.
- 분산 시스템에서 이벤트 순서화 문제, 특히 인과성과 전체 순서화와 관련된 문제를 검토합니다.
- 분산 트랜잭션을 원자적으로 커밋하는 방법을 살펴봅니다.

<br/>

## 선형성

- 최종적 일관성을 지닌 데이터베이스에서 두 개의 다른 복제본의 같은 질문을 동시에 하면 두 가지 다른 응답을 받을 수도 있습니다.
- 위 문제에서 데이터베이스가 복제본이 하나만 있다면 더 단순해지지 않을까라는 생각을 할 수 있으며, 이는 **선형성**을 뒷받침해주는 아이디어입니다.
- 선형성은 **원자적 일관성(atomic consistency), 강한 일관성(strong consistency), 즉각 일관성(immediate consistency), 외부 일관성(external consistency)** 라고 합니다.
  - 기본적인 아이디어는 시스템에 데이터 복사본이 하나만 있고 그 데이터를 대상으로 수행하는 모든 연산은 원자적인 것처럼 보이게 만드는 것입니다.
- 선형성 시스템에서는 클라이언트가 쓰기를 성공적으로 완료하자마자 그 데이터베이스를 읽는 모든 클라이언트는 방금 쓰여진 값을 볼 수 있어야 합니다.
  - 즉, 선형성은 **최신성 보장(recency guarantee)** 를 의미합니다.

![비선형적 구조](https://user-images.githubusercontent.com/42582516/142873723-3f488219-86aa-4f9c-b26f-6a1f89c5a1b1.png)

### 시스템에 선형성을 부여하는 것은 무엇인가?

### 선형성에 기대기

### 선형성 시스템 구현하기

### 선형성의 비용

<br/>

## 순서화 보장

### 순서화와 인과성

### 일련번호 순서화

### 전체 순서 브로드캐스트

<br/>

## 분산 트랜잭션과 합의

### 원자적 커밋과 2단계 커밋(2PC)

### 현실의 분산 트랜잭션

### 내결함성을 지닌 합의

### 멤버십과 코디네이션 서비스

<br/>

## 정리
