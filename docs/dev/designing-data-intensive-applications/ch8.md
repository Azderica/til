---
sidebar_position: 8
---

# 8. 분산 시스템의 골칫거리

- 지난 몇개의 장은 시스템이 잘못된 것을 어떻게 처리하냐에 대한 내용이였습니다.
- 그러나, 현실을 더 비관적으로 보면 어떤 것이든 **잘못될 가능성**이 있습니다.
- 분산 시스템을 다루는 것은 한 컴퓨터의 문제와 근본적으로 다르며, 여러 **창의적인 방법**이 있습니다.

엔지니어의 목표는 모든게 잘못되도 제 역할을 수행하는 시스템을 구축하는 것입니다. 그러기 전 아래에서는 어떤 도전에 직면해 있는지에 대해 이야기합니다.

<br/>

## 결함과 부분 장애

- 컴퓨터에서 프로그램을 작성할 때는 프로그램은 보통 돌아가거나 안돌아가거나로 나뉩니다.
- 가끔 컴퓨터가 재부팅하면 고쳐진다고 생각하지만, 이는 대부분 잘못 작성한 소프트웨어의 결과입니다.
- 단일 컴퓨터에서 실행되는 소프트웨어를 믿지 못할 근본적인 이유는 없습니다.
  - 하드웨어가 올바르게 돌아가면 같은 연산은 항상 같은 결과를 만듭니다. **(결정적)**
- 좋은 소프트웨어가 설치된 각각의 컴퓨터는 보통 완전하게 동작하거나 전체 장애가 발생하지 중간 상태가 되지는 않습니다.
  - 컴퓨터 설계시 의도한 부분입니다.
- **네트워크로 연결된 여러 컴퓨터에서 실행되는 소프트웨어는 근본적으로 상황이 다릅니다.**
  - 분산 시스템에서는 매우 광범위한 것들이 잘못될 수 있습니다.
- 분산 시스템에서는 시스템의 어떤 부분은 잘 동작하지만 다른 부분은 예측할 수 없는 방식으로 고장이 나는데 이를 **부분 장애(partial failure)** 라고 합니다.
- 부분 장애는 **비결정적**(성공했는지 아닌지 알지 못할 수 있음)이므로 어렵습니다.

### 클라우드 컴퓨팅과 슈퍼 컴퓨팅

- 기업형 데이터센터는 **고성능 컴퓨팅 분야**와 **클라우드 컴퓨팅**의 **중간 지점**에 있습니다.

![기업형 데이터센터](https://user-images.githubusercontent.com/42582516/141701886-b633c5b7-4809-46ed-869a-b52c6bfd087a.png)

- 위의 철학에 따라 결함 처리 방법도 매우 다릅니다.
  - 슈퍼컴퓨터는 분산 시스템보다는 단일 노드 컴퓨터에 가깝기 때문에, 부분 장애를 전체 장애로 확대하는 방법으로 처리합니다. (장애시, 전체가 죽도록 만듦)
- 이 책은 인터넷 서비스를 구현하는 시스템을 집중적으로 다루며 이는 보통 슈퍼컴퓨터와 매우 다릅니다.
  - 인터넷 관련 어플리케이션은 언제든 사용자에게 지연 시간이 낮은 서비스를 제공하므로 **온라인**입니다.
  - 슈퍼컴퓨터는 특화된 하드웨어를 사용해서 각 노드 사이의 신뢰성이 높으며, 공유 메모리, 원격 직접 메모리 접근 방식을 사용하나 클라우드 서비스의 노드는 상용 장비를 사용하므로 **낮은 비용으로 동일한 성능을 제공하나 실패율이 높습니다.**
  - 거대한 데이터센터의 네트워크는 흔히 **IP와 이더넷을 기반으로 하며 높은 양단 대역폭을 제공**하기 위해 클로스 토폴로지로 연결되어 있습니다.
  - 시스템이 커질수록 구성 요소 중 하나가 **고장날 가능성도 높아집니다.**
  - **시스템이 장애가 난 노드를 감내할 수 있고 전체적으로는 계속 동작할 수 있다면 이는 운영과 유지보수에 매우 유용한 특성**이 됩니다.
  - 지리적으로 분산된 배포를 할 때 통신은 대부분 인터넷을 거치나 **로컬 네트워크에 비해 느리고 신뢰성이 떨어집니다.**
- 분산 시스템이 동작하게 만드려면 부분 장애 가능성을 받아들이고 소프트웨어에 내결함성 메커니즘을 넣어야합니다. 즉, **신뢰성 없는 구성 요소를 사용해 신뢰성 있는 시스템을 구축해야 합니다.**

> 신뢰성 없는 구성 요소를 사용해 신뢰성 있는 시스템 구축하기

- 대표적인 예시로 다음과 같습니다.
  - 오류 수정 코드(error-correcting code)는 무선 네트워크에서 발생하는 전파 장애 등의 이유로 가끔 일부 비트가 잘못되는 통신 채널을 통해 디지털 데이터를 정확히 전송할 수 있게 해줍니다.
  - IP는 신뢰성이 없습니다. IP를 사용할 때 패킷은 누락, 지연, 중복, 순서변경 등이 발생할 수 있으므로 **TCP(Transmission Control Protocol, 전송 제어 프로토콜)** 를 통해 신뢰성이 높은 전송 계층을 제거합니다.
- 시스템은 기반이 되는 부분보다 높은 신뢰성을 가질 수는 있으나 신뢰성을 얼마나 더 높일 수 있는지는 항상 제한이 있습니다.
- 좀 더 신뢰성 있는 상위 수준 시스템은 완벽하지 않지만 유용합니다. 까다운 저수준 결함 중 일부를 처리해주므로 남은 결함은 보통 따져보고 처리하기가 더 쉽기 때문입니다.

<br/>

## 신뢰성 없는 네트워크

### 현실의 네트워크 결함

### 결함 감지

### 타임아웃과 기약 없는 지연

### 동기 네트워크 대 비동기 네트워크

<br/>

## 신뢰성 없는 시계

### 단조 시계 대 일 기준 시계

### 시계 동기화와 정확도

### 동기화된 시계에 의존하기

### 프로세스 중단

<br/>

## 지식, 진실, 그리고 거짓말

### 진실은 다수결로 결정됩니다.

### 비잔틴 결함

### 시스템 모델과 현실

<br/>

## 정리
