---
sidebar_position: 5
---

# 5. 구부러지거나 부러지거나

- 빠른 변화 속도에 맞추기 위해서는 가능한 느슨하고 유연한 코드를 작성하는 것이 좋습니다.
- 되돌릴 수 있는 의사 결정을 내릴 수 있는 구체적인 방법에 대해 아래에서 설명합니다. 이를 잘 사용하면 유연성과 적응성을 잃지 않게 됩니다.
- 모듈간의 의존 정도를 의미하는 결합도를 줄이는 방법에 대해서도 이야기합니다.
- 유연함을 유지하는 한 가지 좋은 방법은 가능한 적은 양의 코드를 작성하는 것입니다.

## Item 26. 결합도 줄이기와 디미터 법칙

> 좋은 울타리는 좋은 이웃을 만든다.

- 이전 챕터의 직교성과 계약에 의한 설계에서 샤이 코드를 작성하는 것이 이롭습니다.
- 코드를 모듈로 구성하고 이들 간의 상호작용을 제한합니다. 이러한 모듈이 변경되거나 교체된다 하더라도 다른 모듈은 변경 없이 수행될 수 있을 것입니다.

### 결합도 줄이기

- 소프트웨어에서도객체에게 요청을 했을 때 다른 객체로 넘겨 처리하는 것은 좋지 않습니다.
- **의존의 증가는 시스템의 변화가 코드에 영향을 미칠 수 있는 위험이 커집니다.**
- 직접 객체간의 관계가 깨지고 의존 관계가 종합적으로 되어 있는 경우 다양한 방식으로 나타납니다.
  - 단위 테스트를 링크하기 위한 명령어가 테스트 프로그램 자체보다 긴 대규모 C, C++ 프로젝트
  - 한 모듈의 '간단한' 수정이 이와 관계없는 모듈을 통해 시스템 전역에 퍼져나가는 경우
    - 개발자가 수정한 부분이 시스템에 어떤 영향을 미칠지 몰라 코드의 수정을 두려워 하는 경우

불필요한 의존이 많은 시스템은 유지보수하기 어렵고, 비용이 많이 들며 시스템 자체가 매우 불안저ㅇ한 경향이 있습니다. 이러한 의존도를 최소화하기 위해 **디미터 법칙**을 사용하여 메서드, 함수를 설계합니다.

### 디미터 함수 법칙

- 디미터 함수 법칙은 프로그램에서 모듈간 결합도를 최소화하려 시도합니다.
- 해당 법칙은 한 객체가 제공하는 메서드에 접근하기 위해 또 다른 객체들을 통하는 것을 허용하지 않습니다.

> Tip 36. 모듈간의 결합도를 최소화하라

### 확실히 차이를 낳는가?

- 응답 집합(response set)이 큰 클래스는 작은 클래스보다 에러를 발생시키기 쉽습니다.
- 응답집합은 클래스의 메서드가 직접 호출하는 함수의 수를 의미합니다.

```c++
class Demeter {
private:
  A *a;
  int func();
public:
  // ...
  void example(B& b);
}

void Demeter::example(B& b) {
  C c;
  int f = func();   // 자신
  b.invert();       // 메서드로 넘어온 인사
  a = new A();
  a->setActive();   // 자신이 생성한 객체
  c.print();        // 직접 포함하고 있는 객체
}
```

- 디미터 함수를 따르면 함수를 호출하는 클래스의 응답집합 크기를 줄일 수 있기 때문에 좀 더 에러가 적은 클래스들을 만들 수 있습니다.
- 디미터 법칙은 코드를 더 적응성 있고 강하게 만들어 주지만 주계약자로서의 대가를 치러야합니다.
- 주 계약자는 모든 하부 계약자를 직접 관리하고 이들에게 일을 위임해주어야 합니다.
- 다만 이는 언어에 따라서 달라질 수도 금지해야 할 수도 있습니다.
- 디미터 법칙 역시 만들려는 애플리케이션에 맞게 장점과 단점을 잘 고려해야 합니다.
- 디미터 법칙과 반대로 **여러 모듈의 결합도를 높힘**으로써 중요한 **성능향상**을 꾀하는 경우도 존재합니다.

그러나, 이러한 경우가 아니라면 **깨지기 쉽고 유연하지 않은 미래**를 향해 가고 있는 것입니다.

<br/>

## Item 27. 메타 프로그래밍

> 아무리 뛰어난 천재라도 세부사항에 집착하면 그 재능이 발휘되지 않는 법입니다.

- 세부 사항은 우리의 깔끔한 코드를 어질러 놓습니다.
- 세부 사항을 코드에서 몰아내면 우리의 코드는 매우 설정 가능(comfigurable)하게 되고 소프트해집니다.
- 즉, **변화에 쉽게 적응할 수 있게 됩니다.**

### 동적 설정

- 시스템을 되도록 설정가능하게 만드는 것이 중요합니다.

> Tip 37. 통합하지 말고 설정하라.

- 메타데이터(metadata)를 이용해서 반환 매개 변수, 사용자 선호사항, 설치 디렉터리와 같은 애플리케이션 설정 옵션을 기술합니다.
- 메타데이터란 데이터에 관한 데이터입니다.
  - 데이터베이스 스키마, 데이터 디렉터리 등을 대표적인 예로 들 수 있습니다.
- 넓은 의미의 메타데이터는 애플리케이션을 기술하는 모든 데이터입니다.

### 메타데이터 주도 애플리케이션

- 가능한 많은 메타데이터를 써서 애플리케이션을 설정하고 실행시킵니다.
- 동적이고 적응가능한 프로그램을 만드는 것입니다.
- 일반적인 경우에 대해서 프로그램을 만들고, 특별한 것들은 컴파일된 코드 밖 어딘가에 내놓는 것이 중요합니다.

> Tip 38. 코드에는 추상화를, 메타데이터에는 세부 내용을

이와 같은 접근은 다음의 이점을 가집니다.

- 설계의 결합도를 줄여 좀 더 유연하고 적응성 있는 프로그램을 만들 수 있습니다.
- 세부사항을 코드 밖으로 몰아냄으로써 보다 강하고 추상적인 디자인을 만들 수 있습니다.
- 애플리케이션을 커스터마이징하기 위해 다시 컴파일할 필요가 없습니다.
- 메타데이터는 범용 프로그래밍 언어보다 문제 도메인에 가까운 방식으로 표현될 수 있습니다.
- 동일한 애플리케이션 엔진과 상이한 메타데이터를 이용해 여러 다른 프로젝트를 진행할 수 있게 됩니다.

#### 비지니스 로직

#### 예제: 엔터프라이즈 자바빈즈

#### 협동적 설정

### 도도 코드를 작성하지 말라

<br/>

## Item 28. 시간적 결합

<br/>

## Item 29. 단지 뷰일 뿐이야

<br/>

## Item 30. 칠판